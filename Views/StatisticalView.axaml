<UserControl
  x:Class="Views.StatisticalView"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:conv="clr-namespace:Utils;assembly=Utils"
  xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.Avalonia;assembly=LiveChartsCore.SkiaSharpView.Avalonia"
  xmlns:model="using:Models"
  xmlns:vm="using:ViewModels"
  x:Name="Root"
  x:DataType="vm:StatisticalViewModel">

  <!--  GRID CHA BAO HẾT  -->
  <Grid RowDefinitions="Auto,Auto,Auto,*">

    <!--  1) HEADER + FILTER (giữ nguyên nội dung cũ)  -->
    <Grid
      Grid.Row="0"
      Classes="MainLayout"
      RowDefinitions="Auto,Auto,*,Auto">
      <!--  Header giống UserView  -->
      <Grid Classes="MainLayoutHeader" ColumnDefinitions="*,Auto">
        <StackPanel Classes="MainLayoutHeaderInfo">
          <!--  Titlte  -->
          <TextBlock Classes="Title" Text="{Binding TitlePage}" />
          <!--  SubTitle  -->
          <TextBlock Classes="SubTitle" Text="{Binding DescriptionPage}" />
        </StackPanel>

        <StackPanel Grid.Column="1" Classes="MainLayoutHeaderButtons">
          <Button
            x:Name="InfoButton"
            Classes="CrudButton Info"
            Command="{Binding LoadDetailCommand}">
            <Border BorderBrush="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=Button}}">
              <StackPanel>
                <Image Source="{DynamicResource InfoIcon}" />
                <TextBlock Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" Text="Chi tiết" />
              </StackPanel>
            </Border>
          </Button>
        </StackPanel>
      </Grid>

      <!--  Filter  -->
      <Border Grid.Row="1" Classes="FilterDataWarper">
        <Grid Classes="FilterData" RowDefinitions="*,Auto">
          <StackPanel Classes="FilterDataInputs">

            <ComboBox
              Width="400"
              Height="40"
              DisplayMemberBinding="{Binding DisplayText}"
              ItemsSource="{Binding Terms}"
              PlaceholderText="Chọn năm học"
              SelectedItem="{Binding SelectedTerm, Mode=TwoWay}" />
          </StackPanel>
          <Button
            HorizontalAlignment="Right"
            VerticalAlignment="Center"
            Classes="FilterDataResetButton"
            Command="{Binding ResetSearchCommand}">
            <Image Source="{DynamicResource ResetIcon}" />
          </Button>
        </Grid>
      </Border>
    </Grid>

    <!--  2) THÔNG TIN TỔNG QUAN - DASHBOARD STYLE  -->
    <Border
      Grid.Row="1"
      Margin="12,8,12,8"
      Classes="SummaryContainer">
      <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="16">

        <!--  Tổng số học sinh  -->
        <Border Background="#2196F3" Classes="DashboardCard">
          <StackPanel
            VerticalAlignment="Center"
            Orientation="Horizontal"
            Spacing="12">
            <Border Background="rgba(255,255,255,0.2)" Classes="DashboardIconBackground">
              <Image
                Width="30"
                Height="30"
                Source="{DynamicResource StudentIcon}"
                Stretch="Uniform" />
            </Border>
            <StackPanel>
              <TextBlock Classes="DashboardLabel" Text="Tổng học sinh" />
              <TextBlock Classes="DashboardValue" Text="{Binding TotalStudents}" />
            </StackPanel>

          </StackPanel>
        </Border>

        <!--  Tổng số giáo viên  -->
        <Border
          Grid.Column="1"
          Background="#4CAF50"
          Classes="DashboardCard">
          <StackPanel
            VerticalAlignment="Center"
            Orientation="Horizontal"
            Spacing="12">
            <Border Background="rgba(255,255,255,0.2)" Classes="DashboardIconBackground">
              <Image
                Width="30"
                Height="30"
                Source="{DynamicResource TeacherIcon}"
                Stretch="Uniform" />
            </Border>
            <StackPanel>
              <TextBlock Classes="DashboardLabel" Text="Tổng giáo viên" />
              <TextBlock Classes="DashboardValue" Text="{Binding TotalTeacher}" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!--  Tổng số lớp học  -->
        <Border
          Grid.Column="2"
          Background="#FF9800"
          Classes="DashboardCard">
          <StackPanel
            VerticalAlignment="Center"
            Orientation="Horizontal"
            Spacing="12">
            <Border Background="rgba(255,255,255,0.2)" Classes="DashboardIconBackground">
              <Image
                Width="30"
                Height="30"
                Source="{DynamicResource ClassIcon}"
                Stretch="Uniform" />
            </Border>
            <StackPanel>
              <TextBlock Classes="DashboardLabel" Text="Tổng lớp học" />
              <TextBlock Classes="DashboardValue" Text="{Binding TotalClass}" />
            </StackPanel>
          </StackPanel>
        </Border>

        <!--  Tổng số môn học  -->
        <Border
          Grid.Column="3"
          Background="#FFd5f136"
          Classes="DashboardCard">
          <StackPanel
            VerticalAlignment="Center"
            Orientation="Horizontal"
            Spacing="12">
            <Border Background="rgba(255,255,255,0.2)" Classes="DashboardIconBackground">
              <Image
                Width="30"
                Height="30"
                Source="{DynamicResource SubjectIcon}"
                Stretch="Uniform" />
            </Border>
            <StackPanel>
              <TextBlock Classes="DashboardLabel" Text="Tổng môn học" />
              <TextBlock Classes="DashboardValue" Text="{Binding TotalSubject}" />
            </StackPanel>
          </StackPanel>
        </Border>

      </Grid>
    </Border>

    <!--  3) BIỂU ĐỒ  -->
    <Grid
      Grid.Row="3"
      Margin="12"
      RowDefinitions="Auto,*">
      <StackPanel
        Margin="0,0,0,8"
        Orientation="Horizontal"
        Spacing="12">
        <TextBlock
          FontSize="18"
          FontWeight="Bold"
          Text="Thống kê điểm &amp; hạnh kiểm" />
      </StackPanel>

      <Grid
        Grid.Row="1"
        ColumnDefinitions="*,*,*"
        RowDefinitions="Auto">
        <StackPanel Grid.Column="0" Margin="6">
          <TextBlock
            Margin="0,0,0,6"
            FontWeight="SemiBold"
            Text="Danh hiệu (Giỏi/Trung bình/Khá)" />
          <lvc:PieChart
            Height="250"
            LegendPosition="Right"
            Series="{Binding AcademicSeries}" />
          <TextBlock Margin="0,6,0,0" Text="{Binding AcademicSummary}" />
        </StackPanel>

        <StackPanel Grid.Column="1" Margin="6">
          <TextBlock
            Margin="0,0,0,6"
            FontWeight="SemiBold"
            Text="Hạnh kiểm (Tốt/Khá/Trung bình)" />
          <lvc:PieChart
            Height="250"
            LegendPosition="Right"
            Series="{Binding ConductSeries}" />
          <TextBlock Margin="0,6,0,0" Text="{Binding ConductSummary}" />
        </StackPanel>

        <StackPanel Grid.Column="2" Margin="6">
          <TextBlock
            Margin="0,0,0,6"
            FontWeight="SemiBold"
            Text="Học lực (Giỏi &gt;=8, Khá &gt;=6.5, trung bình &gt;=5)"
            TextWrapping="Wrap" />
          <lvc:PieChart
            Height="250"
            LegendPosition="Right"
            Series="{Binding GpaSeries}" />
          <TextBlock Margin="0,6,0,0" Text="{Binding GpaSummary}" />
        </StackPanel>
      </Grid>
    </Grid>

  </Grid>
</UserControl>
