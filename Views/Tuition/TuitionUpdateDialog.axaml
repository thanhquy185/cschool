<UserControl
  x:Class="Views.Tuition.TuitionUpdateDialog"
  xmlns="https://github.com/avaloniaui"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  xmlns:vm="using:ViewModels"
  mc:Ignorable="d"
  x:DataType="vm:TuitionViewModel">

  <Border Padding="12" Background="#FAFAFA" CornerRadius="8">

    <StackPanel Spacing="8">

      <!-- HEADER -->
      <TextBlock Text="Thiết lập học phí lớp"
                 FontSize="20"
                 FontWeight="Bold"
                 Margin="0,0,0,8"/>

      <!-- TAB HỌC KỲ -->
      <TabControl SelectedIndex="{Binding SelectedTerm}" Height="430">

        <!-- ========================= HK1 ============================= -->
        <TabItem Header="Học kỳ 1">
          <Grid RowDefinitions="*,Auto" Margin="0,4,0,0">

            <!-- Bảng tháng -->
            <DataGrid Grid.Row="0"
                      x:Name="Tuition_Month1"
                      AutoGenerateColumns="False"
                      Classes="TableData"
                      ItemsSource="{Binding MonthsHK1}"
                      SelectedItem="{Binding SelectedMonthTuition, Mode=TwoWay}"
                      SelectionChanged="MonthHK1_SelectionChanged">

              <DataGrid.Columns>
                <DataGridTextColumn Width="*" Binding="{Binding MonthName}" Header="Tháng" />
                <DataGridTextColumn Width="*" Binding="{Binding Amount, StringFormat='{}{0:N0} đ'}" Header="Tổng tiền" />
              </DataGrid.Columns>

            </DataGrid>

            <!-- Bảng loại phí của tháng -->
            <StackPanel Grid.Row="1" Margin="0,12,0,0">
              <TextBlock Text="Danh sách loại phí" 
                         FontWeight="Bold" 
                         FontSize="14" 
                         Margin="0,0,0,4"/>

              <DataGrid ItemsSource="{Binding BaseFees1}"
                        AutoGenerateColumns="False"
                        Height="180"
                        Classes="TableData"
                        IsReadOnly="False">

                <DataGrid.Columns>

                  <!-- Template column để IsSelected hiển thị đúng -->
                  <DataGridTemplateColumn Header="Chọn">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                        <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" Checked="FeeCheckBox_Changed" Unchecked="FeeCheckBox_Changed" />
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>

                  <DataGridTextColumn Header="Loại phí" Binding="{Binding Name}" />
                  <DataGridTextColumn Header="Số tiền" Binding="{Binding Amount, StringFormat='{}{0:N0} đ'}" />
                </DataGrid.Columns>
              </DataGrid>
            </StackPanel>

          </Grid>
        </TabItem>

        <!-- ========================= HK2 ============================= -->
        <TabItem Header="Học kỳ 2">
          <Grid RowDefinitions="*,Auto" Margin="0,4,0,0">

            <!-- Bảng tháng -->
            <DataGrid Grid.Row="0"
                      x:Name="Tuition_Month2"
                      AutoGenerateColumns="False"
                      Classes="TableData"
                      ItemsSource="{Binding MonthsHK2}"
                      SelectedItem="{Binding SelectedMonthTuition, Mode=TwoWay}"
                      SelectionChanged="MonthHK2_SelectionChanged"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch">

              <DataGrid.Columns>
                <DataGridTextColumn Width="*" Binding="{Binding MonthName}" Header="Tháng" />
                <DataGridTextColumn Width="*" Binding="{Binding Amount, StringFormat='{}{0:N0} đ'}" Header="Tổng tiền" />
              </DataGrid.Columns>

            </DataGrid>

            <!-- Bảng chi tiết phí Tháng (HK2) -->
            <StackPanel Grid.Row="1" Margin="0,12,0,0">
              <TextBlock Text="Danh sách loại phí" 
                         FontWeight="Bold" 
                         FontSize="14" 
                         Margin="0,0,0,4"/>

              <DataGrid ItemsSource="{Binding BaseFees2}"
                        AutoGenerateColumns="False"
                        Height="180"
                        Classes="TableData"
                        IsReadOnly="False">

                <DataGrid.Columns>

                  <DataGridTemplateColumn Header="Chọn">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                      <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}" Checked="FeeCheckBox_Changed" Unchecked="FeeCheckBox_Changed" />
                      </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                  </DataGridTemplateColumn>

                  <DataGridTextColumn Header="Loại phí" Binding="{Binding Name}" />
                  <DataGridTextColumn Header="Số tiền" Binding="{Binding Amount, StringFormat='{}{0:N0} đ'}" />
                </DataGrid.Columns>
              </DataGrid>
            </StackPanel>

          </Grid>
        </TabItem>

      </TabControl>

      <!-- BUTTONS -->
      <StackPanel Orientation="Horizontal" 
                  HorizontalAlignment="Right" 
                  Spacing="8" 
                  Margin="0,4,0,0">
        <Button Content="Hủy" Classes="CancelButton" Padding="8,4"/>
        <Button Content="Lưu" Classes="CreateButton" Padding="8,4" Click="Save"/>
      </StackPanel>

    </StackPanel>

  </Border>

</UserControl>
